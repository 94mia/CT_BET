source('~/Dropbox/CTR/DHanley/CT_Registration/Final_Brain_Seg/programs/Convert_DCM.R')
rm(list=ls())
library(cttools)
library(fslr)
library(oro.dicom)
library(bitops)
library(arules)
options(matlab.path='/Applications/MATLAB_R2013b.app/bin')
options(fsl.path='/usr/local/fsl')
# username <- Sys.info()["user"][[1]]
rootdir = path.expand("~/CT_Registration/Final_Brain_Seg/Test_Cases/")
homedir <- file.path(rootdir)
#basedir <- file.path("/Volumes/CT_Data/MISTIE")
setwd(homedir)
ids = list.dirs(homedir, recursive=FALSE, full.names=FALSE)
ids = basename(ids)
ids = grep("\\d\\d\\d-(\\d|)\\d\\d\\d", ids, value=TRUE)
length(ids)
ROIformat = FALSE
iid = 1
# ids = ids[grep("101-307", ids)]
ids = ids[grep("102-317", ids)]
dis
ids
id <- ids[iid]
basedir = file.path(homedir, id)
ssdir = file.path(basedir, "Skull_Stripped")
if (!file.exists(ssdir)){
dir.create(ssdir)
}
print(id)
### time for convertsion
contime <- NULL
gf = getfiles(basedir)
# t = iconv("UTF-8","UTF-8//IGNORE",$t);
verbose =TRUE
untar = FALSE
convert <- TRUE
skullstrip <- TRUE
plotss = TRUE
regantry <- FALSE
untgantry <- FALSE
runall <- TRUE
useRdcmsort= TRUE
useRdcm2nii= FALSE
removeDups = TRUE
isSorted = NULL
if (ROIformat) isSorted = FALSE
dcm2niicmd = "dcm2nii_2009"
if ( length(gf$files) > 0 | untar){
contime <- system.time(convert_DICOM(basedir,
verbose=verbose, untar=untar,
useRdcmsort= useRdcmsort,
useRdcm2nii= useRdcm2nii,
id = id,
isSorted = isSorted,
removeDups=removeDups,
dcmsortopt=dcmsortopt,
ROIformat = FALSE,
dcm2niicmd=dcm2niicmd,
gt_correct=FALSE,
add.img.dir=FALSE))
}
mid.folder = function(x, folname = ""){
d = dirname(x)
b = basename(x)
file.path(d, folname, b)
}
imgs = list.files(basedir, pattern = "\\.nii", recursive=FALSE,
full.names=TRUE)
iimg = 1
scen = expand.grid(int=c("0.01", "0.1", "0.35"),
presmooth=c(TRUE, FALSE),
refill = c(TRUE, FALSE))
rownames(scen)= NULL
w = which(!scen$presmooth & scen$refill)
scen = scen[-w, ]
scen
scen = scen[ scen$refill, ]
scen
img = imgs[iimg]
ofile = nii.stub(img)
ofile = mid.folder(ofile, "Skull_Stripped")
ofile = paste0(ofile, "_SS")
iscen = 1
int = scen$int[iscen]
presmooth = scen$presmooth[iscen]
refill = scen$refill[iscen]
app = "_nopresmooth"
if (presmooth) app = ""
re_app = ""
if (refill) re_app = "_refill"
outfile = paste0(ofile, "_", int, app, re_app)
outfile
rm(list=ls())
library(cttools)
library(fslr)
library(oro.dicom)
library(bitops)
library(arules)
options(matlab.path='/Applications/MATLAB_R2013b.app/bin')
options(fsl.path='/usr/local/fsl')
# username <- Sys.info()["user"][[1]]
rootdir = path.expand("~/CT_Registration/Final_Brain_Seg/Test_Cases")
homedir <- file.path(rootdir)
#basedir <- file.path("/Volumes/CT_Data/MISTIE")
setwd(homedir)
ids = list.dirs(homedir, recursive=FALSE, full.names=FALSE)
ids = basename(ids)
ids = grep("\\d\\d\\d-(\\d|)\\d\\d\\d", ids, value=TRUE)
length(ids)
ROIformat = FALSE
iid = 1
# ids = ids[grep("101-307", ids)]
ids = ids[grep("102-317", ids)]
for (iid in seq_along(ids)){
id <- ids[iid]
basedir = file.path(homedir, id)
ssdir = file.path(basedir, "Skull_Stripped")
if (!file.exists(ssdir)){
dir.create(ssdir)
}
print(id)
### time for convertsion
contime <- NULL
gf = getfiles(basedir)
# t = iconv("UTF-8","UTF-8//IGNORE",$t);
verbose =TRUE
untar = FALSE
convert <- TRUE
skullstrip <- TRUE
plotss = TRUE
regantry <- FALSE
untgantry <- FALSE
runall <- TRUE
useRdcmsort= TRUE
useRdcm2nii= FALSE
removeDups = TRUE
isSorted = NULL
if (ROIformat) isSorted = FALSE
dcm2niicmd = "dcm2nii_2009"
if ( length(gf$files) > 0 | untar){
contime <- system.time(convert_DICOM(basedir,
verbose=verbose, untar=untar,
useRdcmsort= useRdcmsort,
useRdcm2nii= useRdcm2nii,
id = id,
isSorted = isSorted,
removeDups=removeDups,
dcmsortopt=dcmsortopt,
ROIformat = FALSE,
dcm2niicmd=dcm2niicmd,
gt_correct=FALSE,
add.img.dir=FALSE))
}
mid.folder = function(x, folname = ""){
d = dirname(x)
b = basename(x)
file.path(d, folname, b)
}
}
imgs = list.files(basedir, pattern = "\\.nii", recursive=FALSE,
full.names=TRUE)
iimg = 1
scen = expand.grid(int=c("0.01", "0.1", "0.35"),
presmooth=c(TRUE, FALSE),
refill = c(TRUE, FALSE))
rownames(scen)= NULL
w = which(!scen$presmooth & scen$refill)
scen = scen[-w, ]
scen = scen[ scen$refill, ]
img = imgs[iimg]
ofile = nii.stub(img)
ofile = mid.folder(ofile, "Skull_Stripped")
ofile = paste0(ofile, "_SS")
iscen = 1
int = scen$int[iscen]
presmooth = scen$presmooth[iscen]
refill = scen$refill[iscen]
app = "_nopresmooth"
if (presmooth) app = ""
re_app = ""
if (refill) re_app = "_refill"
outfile = paste0(ofile, "_", int, app, re_app)
x = CT_Skull_Strip(img = img,
outfile = outfile,
retimg=FALSE, verbose=TRUE,
opts=paste0("-f ", int, " -v"),
inskull_mesh = FALSE,
refill = refill,
presmooth=presmooth)
iscen
scen = scen[2:nrow(scen),]
for (iscen in seq(nrow(scen))){
int = scen$int[iscen]
presmooth = scen$presmooth[iscen]
refill = scen$refill[iscen]
app = "_nopresmooth"
if (presmooth) app = ""
re_app = ""
if (refill) re_app = "_refill"
outfile = paste0(ofile, "_", int, app, re_app)
x = CT_Skull_Strip(img = img,
outfile = outfile,
retimg=FALSE, verbose=TRUE,
opts=paste0("-f ", int, " -v"),
inskull_mesh = FALSE,
refill = refill,
presmooth=presmooth)
}
source('~/Dropbox/CTR/DHanley/CT_Registration/Final_Brain_Seg/programs/Convert_DCM.R')
